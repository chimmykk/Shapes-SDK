"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createAnalyzeImage = createAnalyzeImage;
const fs_1 = __importDefault(require("fs"));
function coreAnalyzeImage(client, model) {
    return async (imagePath, promptText = "What's in this image?") => {
        const buffer = fs_1.default.readFileSync(imagePath);
        const base64 = buffer.toString("base64");
        const dataUrl = `data:image/png;base64,${base64}`;
        const res = await client.chat.completions.create({
            model,
            messages: [
                {
                    role: "user",
                    content: [
                        { type: "text", text: promptText },
                        { type: "image_url", image_url: { url: dataUrl } },
                    ],
                },
            ],
        });
        return res.choices[0].message.content;
    };
}
function createAnalyzeImage(client, defaultModel = "shapesinc/tenshi") {
    const analyzeImage = async (imagePath, promptText, model = defaultModel) => coreAnalyzeImage(client, model)(imagePath, promptText);
    analyzeImage.model = new Proxy({}, {
        get(_, modelName) {
            return coreAnalyzeImage(client, modelName);
        },
    });
    return analyzeImage;
}
